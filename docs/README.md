# 速记软件后端设计文档

## 📋 文档概述

本文档提供了一套完整的速记软件后端系统设计，包含9个详细的流程图和技术实现方案。

## 📁 文件列表

| 文件 | 描述 |
|------|------|
| [01-系统架构图.md](./01-系统架构图.md) | 整体系统架构和技术栈概览 |
| [02-注册模块流程图.md](./02-注册模块流程图.md) | 用户注册和分类选择流程 |
| [03-分类模块流程图.md](./03-分类模块流程图.md) | 分类、标签、关系管理 |
| [04-速记模块流程图.md](./04-速记模块流程图.md) | 事件和速记的创建与关联 |
| [05-录音模块流程图.md](./05-录音模块流程图.md) | 录音、转文字、处理流程 |
| [06-搜索模块流程图.md](./06-搜索模块流程图.md) | 智能搜索和检索实现 |
| [07-展示模块流程图.md](./07-展示模块流程图.md) | 时间轴和事件中心展示 |
| [08-定时任务与集成流程.md](./08-定时任务与集成流程.md) | 后台任务和数据同步 |
| [09-完整数据流图.md](./09-完整数据流图.md) | 全系统数据流和集成 |

## 🎯 核心特性

### 1. AI驱动的智能关联
- **全局关联**：事件创建后，使用LangChain Agent分析所有可能相关的内容（分类、标签、事件、速记）
- **增量关联**：速记创建后，基于用户现有关系图谱进行智能关联
- **标签生成**：自动生成智能标签，并优先匹配现有标签

### 2. 多维度分类体系
- **分类**：一级分类 + 二级分类（用户可跳过，默认全选）
- **标签**：自动生成 + 手动创建
- **关系**：事件之间的依赖、阻塞、触发等关系
- **事件维度**：项目、长期任务、重要事件、性格特征

### 3. 智能搜索
- **全文搜索**：基于Neo4j全文索引
- **向量搜索**：语义相似度检索
- **图搜索**：关系路径查询
- **智能Agent**：自然语言查询理解 + 多结果融合

### 4. 多种展示模式
- **时间轴模式**：按时间展示所有内容，可视化关系线
- **事件中心模式**：以事件为核心，展示层级结构和相关内容
- **混合模式**：结合时间轴和事件中心

### 5. 录音转文字
- 实时音频采集和可视化
- 语音识别（STT）服务集成
- 自动文本处理（标点、分段）
- 与速记系统无缝集成

## 🏗️ 技术架构

### 数据存储
| 组件 | 用途 |
|------|------|
| **MySQL** | 用户信息、会话、速记/事件基础数据 |
| **Neo4j** | 分类、标签、事件关系图谱 |
| **Redis** | 缓存、会话管理、搜索结果 |
| **对象存储** | 音频文件存储 |

### AI能力
- **LangChain**：Agent编排、工具调用
- **LLM**：分类生成、关联分析、标签生成、搜索增强
- **嵌入模型**：向量相似度计算

### 基础设施
- **消息队列**：异步任务处理
- **定时任务**：关系更新、数据同步、统计分析
- **日志系统**：系统监控和审计

## 📊 数据模型

### Neo4j图结构

```
User ──PREFERS──> Category
User ──CREATED──> Event
User ──CREATED──> Note

Note ──BELONGS_TO──> Category
Event ──BELONGS_TO──> Category

Note ──TAGGED_WITH──> Tag
Event ──RELATED_TO──> Note
Note ──RELATED_TO──> Event

Event ──DEPENDS_ON──> Event
Event ──BLOCKS──> Event
Note ──CONTAINS──> Audio
```

### 关系权重
- 权重范围：0.0 ~ 1.0
- 权重衰减：基于时间（7天无交互开始衰减）
- 用户行为：增加权重（每次交互 +0.05）

## 🔑 核心流程

### 注册流程
1. 用户填写基本信息
2. 选择一级分类（偏爱用户、学习资料、刊物、运动等）
3. LangChain生成个性化二级分类
4. 用户确认或跳过（默认全选）
5. 创建用户节点和分类关系

### 事件创建流程
1. 用户输入事件信息
2. 保存到MySQL
3. 创建Neo4j节点
4. **全局关联分析**：查询所有分类、标签、事件、速记
5. LangChain Agent分析关联度
6. 创建关系边，推送异步任务
7. 后台Worker更新权重

### 速记创建流程
1. 用户输入速记内容
2. 保存到MySQL
3. 创建Neo4j节点
4. **增量关联分析**：从缓存读取用户图谱
5. 查询一度、二度关系
6. 生成关联建议和智能标签
7. 创建关系和标签

### 搜索流程
1. 分析用户搜索意图
2. 并行执行：向量搜索 + 图搜索
3. 融合和重排序结果
4. 生成搜索解释
5. 缓存结果

## 📝 待实现细节

1. **数据库Schema**：详细的MySQL表结构和Neo4j索引配置
2. **API接口文档**：RESTful API的完整定义
3. **错误处理**：统一的错误码和异常处理
4. **安全机制**：认证、授权、数据加密
5. **性能优化**：查询优化、缓存策略、批量操作
6. **监控告警**：系统监控、性能指标、错误告警

## 🚀 快速开始

1. 阅读 [01-系统架构图.md](./01-系统架构图.md) 了解整体架构
2. 按模块顺序阅读02-08的详细流程图
3. 参考 [09-完整数据流图.md](./09-完整数据流图.md) 理解数据流转
4. 根据实际需求调整和实现

## 📞 联系方式

如有疑问或建议，欢迎反馈。

---

*设计日期：2026-02-13*
*版本：v1.0*
